var Schedule;(function(n){var f=function(){function n(n,t,i,r){this.name=n,this.index=t,this.color=i,this.type=r}return n}(),u,i,r,e,o,t,s;n.Employee=f,function(n){n[n.Teacher=0]="Teacher",n[n.Helper=1]="Helper"}(n.EmployeeType||(n.EmployeeType={})),u=n.EmployeeType,function(n){n[n.EinzelGruppeFrueh=0]="EinzelGruppeFrueh",n[n.DoppelGruppe=1]="DoppelGruppe",n[n.Mittagessen=2]="Mittagessen",n[n.KuecheRastenAufbleiber=3]="KuecheRastenAufbleiber",n[n.EinzelGruppe=4]="EinzelGruppe",n[n.EinzelGruppeReinigung=5]="EinzelGruppeReinigung"}(n.WorkUnitType||(n.WorkUnitType={})),i=n.WorkUnitType,r=function(){function n(n,t,i){this.beginTime=n,this.endTime=t,this.type=i,this.work=ko.observableArray([])}return n.pad=function(n,t){for(var i=n+"";i.length<t;)i="0"+i;return i},Object.defineProperty(n.prototype,"dayName",{get:function(){var n=new Array(7);return n[0]="Sunday",n[1]="Monday",n[2]="Tuesday",n[3]="Wednesday",n[4]="Thursday",n[5]="Friday",n[6]="Saturday",n[this.beginTime.getDay()]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"shortName",{get:function(){return this.beginTime.getHours()+":"+n.pad(this.beginTime.getMinutes(),2)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"errors",{get:function(){var n=[];switch(this.type){case i.EinzelGruppeFrueh:this.work().some(function(n){return n().employee.type==u.Teacher&&n().type()==t.KinderDienst})||n.push("There must be at least one teacher");break;case i.DoppelGruppe:this.beginTime.getHours()<8?(this.work().filter(function(n){return n().employee.type==u.Teacher&&n().type()==t.KinderDienst}).length<2||this.work().filter(function(n){return n().employee.type==u.Helper&&n().type()==t.KinderDienst}).length<1)&&n.push("There must be 2 teachers and 2 helpers"):(this.work().filter(function(n){return n().employee.type==u.Teacher&&n().type()==t.KinderDienst}).length<2||this.work().filter(function(n){return n().employee.type==u.Helper&&n().type()==t.KinderDienst}).length<2)&&n.push("There must be 2 teachers and 2 helpers");break;case i.Mittagessen:this.work().filter(function(n){return n().type()!=t.Pause}).length>=3||n.push("There must be 3 employees at duty");break;case i.KuecheRastenAufbleiber:this.work().filter(function(n){return n().employee.type==u.Helper&&n().type()==t.Kueche}).length==1&&this.work().filter(function(n){return n().type()==t.Rasten}).length==1&&this.work().filter(function(n){return n().type()==t.Aufbleiber}).length==1||n.push("1x Küche, 1x Rasten, 1x Aufbleiber");break;case i.EinzelGruppe:this.work().filter(function(n){return n().employee.type==u.Teacher&&n().type()==t.KinderDienst}).length==1&&this.work().filter(function(n){return n().employee.type==u.Teacher&&n().type()==t.KinderDienst}).length==1||n.push("1x Päd + 1x Hilf -> Kinderdienst");break;case i.EinzelGruppeReinigung:this.work().filter(function(n){return n().employee.type==u.Teacher&&n().type()==t.KinderDienst}).length>=1&&this.work().filter(function(n){return n().type()==t.Reinigung}).length>=1||n.push("1x Päd -> Kinderdienst + 1x Hilf -> Reinigung")}return n.length>0?n.join("<br>"):"none"},enumerable:!0,configurable:!0}),n}(),n.WorkUnit=r,e=function(){function n(){this.WorkUnits=ko.observableArray([])}return Object.defineProperty(n.prototype,"dayName",{get:function(){return this.WorkUnits()[0].dayName},enumerable:!0,configurable:!0}),n.prototype.errorsForEmployee=function(n){var t={invalid:!1,messages:[]},i=this.checkSixHoursLimit(n);return i.result||(t.invalid=!0,t.messages.push(i.message)),t},n.prototype.checkSixHoursLimit=function(n){console.log("checking six hours");var u=!1,i=this.WorkUnits()[0].beginTime,r=i;return(this.WorkUnits().forEach(function(f){if(f.work()[n.index]().type()==t.Pause)i=f.endTime,r=f.endTime;else{r=f.endTime;var e=r.valueOf()-i.valueOf();e>216e5&&(console.log("too long"),u=!0)}}),u)?{result:!1,message:"work unit longer than six hours"}:{result:!0,message:"ok."}},n}(),n.WorkDay=e,o=function(){function n(n,t,i){this.employee=t,this.workUnit=i,this.type=ko.observable(n),this.text=ko.computed(function(){return this.stringRep()},this),this.css=ko.computed(function(){return"css"+this.text()},this)}return n.prototype.stringRep=function(){switch(this.type()){case t.Pause:return"Pause";case t.KinderDienst:return"Kinder";case t.Aufbleiber:return"Aufbleiber";case t.Kueche:return"Küche";case t.Rasten:return"Rasten";case t.Reinigung:return"Reinigung"}return"other"},n.prototype.changeType=function(){var n=this.type(),r=this.workUnit.type;switch(r){case i.DoppelGruppe:case i.EinzelGruppe:case i.EinzelGruppeFrueh:switch(n){case t.Pause:n=t.KinderDienst;break;case t.KinderDienst:n=t.Pause;break;default:n=t.KinderDienst}break;case i.EinzelGruppeReinigung:switch(n){case t.Pause:n=t.KinderDienst;break;case t.KinderDienst:n=t.Reinigung;break;case t.Reinigung:n=t.Pause;break;default:n=t.KinderDienst}break;case i.KuecheRastenAufbleiber:switch(n){case t.Pause:n=t.Kueche;break;case t.Kueche:n=t.Rasten;break;case t.Rasten:n=t.Aufbleiber;break;case t.Aufbleiber:n=t.Pause;break;default:n=t.Pause}break;case i.Mittagessen:switch(n){case t.Pause:n=t.KinderDienst;break;case t.KinderDienst:n=t.Pause;break;default:n=t.Pause}}this.type(n)},n}(),n.WorkCell=o,function(n){n[n.Pause=0]="Pause",n[n.KinderDienst=1]="KinderDienst",n[n.Kueche=2]="Kueche",n[n.Rasten=3]="Rasten",n[n.Aufbleiber=4]="Aufbleiber",n[n.Reinigung=5]="Reinigung"}(n.WorkType||(n.WorkType={})),t=n.WorkType,s=function(){function n(){var l=this,n,c;for(this.Days=ko.observableArray([]),this.Employees=ko.observableArray([]),this.PlanName=ko.observable("default"),this.Employees.push(new f("Elisabeth",0,"red",u.Teacher)),this.Employees.push(new f("Theresa",1,"green",u.Teacher)),this.Employees.push(new f("Irene",2,"yellow",u.Helper)),this.Employees.push(new f("Renate",3,"palegreen",u.Helper)),this.Employees.push(new f("Andrea",4,"orange",u.Helper)),n=0;n<5;n++){c=new e,this.Days.push(c);var s=2013,h=06,a=[new r(new Date(s,h,22+n,07,00),new Date(s,h,22+n,07,30),i.EinzelGruppeFrueh),new r(new Date(s,h,22+n,07,30),new Date(s,h,22+n,8,00),i.DoppelGruppe),new r(new Date(s,h,22+n,8,00),new Date(s,h,22+n,8,30),i.DoppelGruppe),new r(new Date(s,h,22+n,8,30),new Date(s,h,22+n,9,00),i.DoppelGruppe),new r(new Date(s,h,22+n,9,00),new Date(s,h,22+n,9,30),i.DoppelGruppe),new r(new Date(s,h,22+n,9,30),new Date(s,h,22+n,10,00),i.DoppelGruppe),new r(new Date(s,h,22+n,10,00),new Date(s,h,22+n,10,30),i.DoppelGruppe),new r(new Date(s,h,22+n,10,30),new Date(s,h,22+n,11,00),i.DoppelGruppe),new r(new Date(s,h,22+n,11,00),new Date(s,h,22+n,11,30),i.DoppelGruppe),new r(new Date(s,h,22+n,11,30),new Date(s,h,22+n,12,00),i.Mittagessen),new r(new Date(s,h,22+n,12,00),new Date(s,h,22+n,12,30),i.Mittagessen),new r(new Date(s,h,22+n,12,30),new Date(s,h,22+n,13,00),i.KuecheRastenAufbleiber),new r(new Date(s,h,22+n,13,00),new Date(s,h,22+n,13,30),i.KuecheRastenAufbleiber),new r(new Date(s,h,22+n,13,30),new Date(s,h,22+n,14,00),i.EinzelGruppe),new r(new Date(s,h,22+n,14,00),new Date(s,h,22+n,14,30),i.EinzelGruppe),new r(new Date(s,h,22+n,14,30),new Date(s,h,22+n,15,00),i.EinzelGruppe),new r(new Date(s,h,22+n,15,00),new Date(s,h,22+n,15,30),i.EinzelGruppe),new r(new Date(s,h,22+n,15,30),new Date(s,h,22+n,16,00),i.EinzelGruppeReinigung)];a.forEach(function(n){return c.WorkUnits.push(n)}),c.WorkUnits().forEach(function(n){l.Employees().forEach(function(i){n.work().push(ko.observable(new o(t.Pause,i,n)))})})}}return n.prototype.totalHours=function(n){for(var f=0,r,u,e,i=0;i<this.Days().length;i++)for(r=0;r<this.Days()[i].WorkUnits().length;r++)u=this.Days()[i].WorkUnits()[r],e=u.work()[n.index](),e.type()!=t.Pause&&(f+=(u.endTime.getTime()-u.beginTime.getTime())/36e5);return console.log(f),f},n.prototype.relativeHours=function(n){return this.totalHours(n)/38.5*100+"%"},n.prototype.serializePlan=function(){var n=[];return this.Days().forEach(function(t){t.WorkUnits().forEach(function(t){t.work().forEach(function(t){n.push(t().type())})})}),JSON.stringify(n)},n.prototype.loadPlan=function(n){var t=JSON.parse(n),i=0;this.Days().forEach(function(n){n.WorkUnits().forEach(function(n){n.work().forEach(function(n){n().type(t[i++])})})})},n.prototype.Save=function(){$.cookie(this.PlanName(),encodeURIComponent(this.serializePlan()))},n.prototype.Load=function(){this.loadPlan(decodeURIComponent($.cookie(this.PlanName())))},n}(),n.Week=s})(Schedule||(Schedule={}))